<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìƒˆ êµë¥˜ì „ / ìš©ë³‘ ëª¨ì§‘ - VolleyLink</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="top-bar">
    <div class="top-bar__left">
      <a href="index.html" class="logo">VolleyLink</a>
      <span class="logo-sub">ëŒ€í•™ ë°°êµ¬ êµë¥˜ì „</span>
    </div>
    <a href="login.html" class="btn btn-outline btn-small">ë¡œê·¸ì¸</a>
  </header>

  <main class="page">
    <section class="card" style="max-width:720px;margin:24px auto;">
      <h1 class="section-title">êµë¥˜ì „ / ìš©ë³‘ ëª¨ì§‘ ê¸€ ì˜¬ë¦¬ê¸°</h1>
      <p class="subtitle">
        ëŒ€í•™ ë°°êµ¬ ë™ì•„ë¦¬ ê°„ êµë¥˜ì „ì´ë‚˜, ìš©ë³‘ì´ í•„ìš”í•  ë•Œ ëª¨ì§‘ ê¸€ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.
      </p>

      <!-- ëª¨ì§‘ ì¢…ë¥˜ -->
      <div class="filter-group">
        <label class="filter-label">ëª¨ì§‘ ì¢…ë¥˜</label>
        <div class="chip-row">
          <label class="chip">
            <input type="radio" name="postType" value="êµë¥˜ì „" checked />
            êµë¥˜ì „
          </label>
          <label class="chip">
            <input type="radio" name="postType" value="ìš©ë³‘" />
            ìš©ë³‘ ëª¨ì§‘
          </label>
        </div>
      </div>

      <!-- í•™êµ/íŒ€ ì´ë¦„ -->
      <input
        id="teamNameInput"
        class="input"
        type="text"
        placeholder="í•™êµ Â· ë™ì•„ë¦¬ëª… (ì˜ˆ: í•œì‹ ëŒ€ ë¹„ìƒ)"
      />

      <!-- ê¸€ ì œëª© -->
      <input
        id="titleInput"
        class="input"
        type="text"
        placeholder="ì œëª© (ì˜ˆ: í•œì‹ ëŒ€ ë¹„ìƒ vs ì—°ì„¸ëŒ€ êµë¥˜ì „ ìƒëŒ€ êµ¬í•©ë‹ˆë‹¤)"
      />

      <!-- ë‚ ì§œ/ì‹œê°„ -->
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">ë‚ ì§œ</label>
          <input id="dateInput" class="input" type="date" />
        </div>
        <div class="filter-group">
          <label class="filter-label">ì‹œê°„</label>
          <input id="timeInput" class="input" type="time" />
        </div>
      </div>

      <!-- ì¥ì†Œ -->
      <input
        id="locationInput"
        class="input"
        type="text"
        placeholder="ì¥ì†Œ (ì˜ˆ: í•œì‹ ëŒ€ ì²´ìœ¡ê´€ / ìƒëŒ€ í•™êµ ë°©ë¬¸ ë“±)"
      />

      <!-- ëª¨ì§‘ ì¸ì› (ì„ íƒ) -->
      <input
        id="capacityInput"
        class="input"
        type="number"
        min="1"
        placeholder="ëª¨ì§‘ ì¸ì› (ì„ íƒ, ì˜ˆ: 12)"
      />

      <!-- ìƒì„¸ ì„¤ëª… -->
      <textarea
        id="noteInput"
        class="input"
        style="min-height:120px;"
        placeholder="ìƒëŒ€ ì¡°ê±´, ì‹¤ë ¥ ìˆ˜ì¤€, ê²½ê¸° ë°©ì‹(9ì¸ì œ/6ì¸ì œ), ì¤€ë¹„ë¬¼, ì£¼ì°¨/ì´¬ì˜ ê°€ëŠ¥ ì—¬ë¶€ ë“± ìì„¸íˆ ì ì–´ì£¼ì„¸ìš”."
      ></textarea>

      <p id="formError" class="auth-error hidden"></p>

      <div class="modal-actions" style="margin-top:16px;">
        <button id="submitButton" class="btn btn-primary btn-small">
          ë“±ë¡í•˜ê¸°
        </button>
        <a href="index.html" class="btn btn-outline btn-small">ì·¨ì†Œ</a>
      </div>
    </section>
  </main>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ğŸ”¥ ì—¬ê¸° firebaseConfigëŠ” ë„¤ í”„ë¡œì íŠ¸ ê°’ìœ¼ë¡œ ë°”ê¿”ì¤˜ (index.htmlì´ë‘ ë˜‘ê°™ì´)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID",
      measurementId: "YOUR_MEASUREMENT_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const teamNameInput = document.getElementById("teamNameInput");
    const titleInput = document.getElementById("titleInput");
    const dateInput = document.getElementById("dateInput");
    const timeInput = document.getElementById("timeInput");
    const locationInput = document.getElementById("locationInput");
    const capacityInput = document.getElementById("capacityInput");
    const noteInput = document.getElementById("noteInput");
    const formError = document.getElementById("formError");
    const submitButton = document.getElementById("submitButton");

    submitButton.addEventListener("click", async () => {
      formError.classList.add("hidden");
      formError.textContent = "";

      const teamName = teamNameInput.value.trim();
      const title = titleInput.value.trim();
      const dateStr = dateInput.value;
      const timeStr = timeInput.value;
      const location = locationInput.value.trim();
      const capacity = capacityInput.value.trim();
      const note = noteInput.value.trim();

      const postTypeInput = document.querySelector(
        'input[name="postType"]:checked'
      );
      const postType = postTypeInput ? postTypeInput.value : "êµë¥˜ì „";

      // í•„ìˆ˜ê°’ ì²´í¬
      if (!teamName || !title || !dateStr || !timeStr || !location) {
        formError.textContent =
          "í•™êµ/ë™ì•„ë¦¬ëª…, ì œëª©, ë‚ ì§œ, ì‹œê°„, ì¥ì†ŒëŠ” í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.";
        formError.classList.remove("hidden");
        return;
      }

      // ë¡œê·¸ì¸ ì—¬ë¶€ ì²´í¬
      if (!auth.currentUser) {
        formError.textContent =
          "ëª¨ì§‘ ê¸€ì„ ì˜¬ë¦¬ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.";
        formError.classList.remove("hidden");
        return;
      }

      // JS Date â†’ Firestore Timestamp
      const dateTime = new Date(`${dateStr}T${timeStr}:00`);
      const matchDate = firebase.firestore.Timestamp.fromDate(dateTime);

      try {
        await db.collection("matches").add({
          postType,          // "êµë¥˜ì „" / "ìš©ë³‘"
          teamName,
          title,
          matchDate,
          dateText: `${dateStr} ${timeStr}`, // ë¦¬ìŠ¤íŠ¸ì—ì„œ ê·¸ëƒ¥ ë³´ì—¬ì¤„ ìš©ë„
          location,
          capacity: capacity ? parseInt(capacity, 10) : null,
          currentCount: 0,
          note,
          status: "ëª¨ì§‘ ì¤‘",
          createdByUid: auth.currentUser.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert("ëª¨ì§‘ ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        // í™ˆìœ¼ë¡œ ì´ë™
        window.location.href = "index.html";
      } catch (error) {
        console.error(error);
        formError.textContent =
          "ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        formError.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
